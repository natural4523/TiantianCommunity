<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/css/community.css">
    <link rel="stylesheet" href="/css/editormd.preview.min.css">
    <script th:src="@{/js/moment.js}" type="application/javascript"></script>
    <script th:src="@{/js/community.js}" type="application/javascript"></script>

    <!--        <script th:src="@{js/bootstrap.min.js}" type="application/javascript"></script>-->
    <!-- Bootstrap -->
    <!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">-->

    <!--    &lt;!&ndash; jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) &ndash;&gt;-->
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <script th:src="@{/js/editormd.min.js}" type="application/javascript"></script>
    <script th:src="@{/js/lib/marked.min.js}" type="application/javascript"></script>
    <script th:src="@{/js/lib/prettify.min.js}" type="application/javascript"></script>


</head>
<body>
<div th:insert="navigation :: nav"></div>
<div class="container-fluid main profile">
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <h2 style="margin-left: 45%;margin-top: 50px">用户注册</h2>

            <form style="margin-top: 2%;margin-bottom: 10%;margin-left: 30%" class="form-horizontal" action="/register" method="post">
                <div class="form-group">
                    <label for="username" class="col-sm-2 control-label">账号</label>
                    <div class="col-sm-10" style="width: 30%">
                        <input type="text" class="form-control" id="username" name="username">
                    </div>
                    <span id="msg1"></span>
                </div>
                <div class="form-group">
                    <label for="password" class="col-sm-2 control-label">密码</label>
                    <div class="col-sm-10" style="width: 30%">
                        <input type="password" class="form-control" id="password" name="password">
                    </div>
                    <span id="msg2"></span>
                </div>
                <div class="form-group">
                    <label for="passwordAga" class="col-sm-2 control-label">确认密码</label>
                    <div class="col-sm-10" style="width: 30%">
                        <input type="password" class="form-control" id="passwordAga"  name="passwordAga">
                    </div>
                    <span id="msg3"></span>
                </div>
                <div class="form-group">
                    <label for="name" class="col-sm-2 control-label">昵称</label>
                    <div class="col-sm-10" style="width: 30%">
                        <input type="text" class="form-control" id="name" name="name">
                    </div>
                    <span id="msg4"></span>
                </div>
                <div class="form-group">
                    <label for="email" class="col-sm-2 control-label">Email</label>
                    <div class="col-sm-10" style="width: 30%">
                        <input type="email" class="form-control" id="email" name="email">
                    </div>
                    <span id="msg5"></span>
                </div>
                <div class="form-group form-inline">
                    <label for="checkQuestion1" class="col-sm-2 control-label">
                        验证问题一
                    </label>
                    <select class="form-control col-sm-10" id="checkQuestion1" th:name="checkQuestion1"
                            style="width: 27%;margin-left: 15px">
                        <option th:each="checkQuestions:${checkQuestionsList1}" th:value="${checkQuestions.id}"
                                th:text="${checkQuestions.name}"></option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="checkAnswer1" class="col-sm-2 control-label">答案一</label>
                    <div class="col-sm-10" style="width: 30%">
                        <input type="text" class="form-control" id="checkAnswer1" name="checkAnswer1">
                    </div>
                    <span id="msg6"></span>
                </div>
                <div class="form-group form-inline">
                    <label for="checkQuestion2" class="col-sm-2 control-label">
                        验证问题二
                    </label>
                    <select class="form-control col-sm-10" id="checkQuestion2" th:name="checkQuestion2"
                            style="width: 27%;margin-left: 15px">
                        <option th:each="checkQuestions:${checkQuestionsList2}" th:value="${checkQuestions.id}"
                                th:text="${checkQuestions.name}"></option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="checkAnswer2" class="col-sm-2 control-label">答案二</label>
                    <div class="col-sm-10" style="width: 30%">
                        <input type="text" class="form-control" id="checkAnswer2" name="checkAnswer2">
                    </div>
                    <span id="msg7"></span>
                </div>
                <div class="form-group form-inline">
                    <label for="checkQuestion3" class="col-sm-2 control-label">
                        验证问题三
                    </label>
                    <select class="form-control col-sm-10" id="checkQuestion3" th:name="checkQuestion3"
                            style="width: 27%;margin-left: 15px">
                        <option th:each="checkQuestions:${checkQuestionsList3}" th:value="${checkQuestions.id}"
                                th:text="${checkQuestions.name}"></option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="checkAnswer3" class="col-sm-2 control-label">答案三</label>
                    <div class="col-sm-10" style="width: 30%">
                        <input type="text" class="form-control" id="checkAnswer3" name="checkAnswer3">
                    </div>
                    <span id="msg8"></span>
                </div>

                <div class="form-group" style="margin-left: 85px">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button type="submit" class="btn btn-default">确认</button>
                    </div>
                </div>
                <span class="alert alert-danger" th:text="${error}" th:if="${error != null}"></span>
            </form>
        </div>
    </div>
</div>
<div th:insert="footer :: foot"></div>
</body>
</html>


<script>
    $(function () {
        var flag1 = false;
        var flag2 = false;
        var flag3 = false;
        var flag4 = false;
        var flag5 = false;
        var flag6 = false;
        var flag7 = false;
        var flag8 = false;

        $("#username").blur(function (t) {
            var username = $("#username").val();

            if (username == ''){
                $('#msg1').html("<font color='red' style='font-size: large;font-family: 华文新魏'>用户名不能为空</font>");
                flag1 = false;
            }else {
                $.ajax({
                    type: "get",
                    url: "/checkUsername/" + username,
                    contentType: "application/json",
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                        if (data == false){
                            $('#msg1').html("<font color='red' style='font-size: large;font-family: 华文新魏'>用户名已存在</font>");
                            flag1 = false;
                        }
                        if (data == true) {
                            $('#msg1').html("<font color='#00fa9a' style='font-size: large;font-family: 华文新魏'>√</font>");
                            flag1 = true;
                        }
                    }
                })
            }
        })

        $("#password").blur(function (t) {
            var password = $(this).val();
            if (password .length == 0) {
                $('#msg2').html("<font color='red' style='font-size: large;font-family: 华文新魏'>密码不能为空！</font>");
                flag2 = false;
            }else if (password.length < 6 && password.length > 0){
                $('#msg2').html("<font color='red' style='font-size: large;font-family: 华文新魏'>密码强度太低，请重新输入!</font>");
                flag2 = false;
            }else {
                $('#msg2').html("<font color='#00fa9a' style='font-size: large;font-family: 华文新魏'>√</font>");
                flag2 = true;
            }
        })


        $("#passwordAga").blur(function (t) {
            var password = $("#password").val();
            var passwordAga = $(this).val();
            if (password != passwordAga){
                $('#msg3').html("<font color='red' style='font-size: medium;font-family: 华文新魏'>两次密码输入不一致</font>");
                flag3 = false;
            }else if(passwordAga == ''){
                $('#msg3').html("<font color='red' style='font-size: medium;font-family: 华文新魏'>×</font>");
                flag3 = false;
            } else{
                $('#msg3').html("<font color='#00fa9a' style='font-size: large;font-family: 华文新魏'>√</font>");
                flag3 = true;
            }
        })

        $("#name").blur(function (t) {
            var name = $(this).val();
            if (name == ''){
                $('#msg4').html("<font color='red' style='font-size: large;font-family: 华文新魏'>昵称不能为空！</font>");
                flag4 = false;
            } else {
                $.ajax({
                    type: "get",
                    url: "/checkName/" + name,
                    contentType: "application/json",
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                        if (data == false){
                            $('#msg4').html("<font color='red' style='font-size: large;font-family: 华文新魏'>该昵称已存在</font>");
                            flag4 = false;
                        }
                        if (data == true) {
                            $('#msg4').html("<font color='#00fa9a' style='font-size: large;font-family: 华文新魏'>√</font>");
                            flag4 = true;
                        }
                    }
                })
            }
        })

        $("#email").blur(function (t) {
            var email = $(this).val();
            if (email == ''){
                $('#msg5').html("<font color='red' style='font-size: large;font-family: 华文新魏'>邮箱不能为空！</font>");
                flag5 = false;
            }else{
                $('#msg5').html("<font color='#00fa9a' style='font-size: large;font-family: 华文新魏'>√</font>");
                flag5 = true;
            }
        })

        $("#checkAnswer1").blur(function (t) {
            var answer = $(this).val();
            if (answer == '') {
                $('#msg6').html("<font color='red' style='font-size: large;font-family: 华文新魏'>答案不能为空！</font>");
                flag6 = false;
            }else{
                $('#msg6').html("<font color='#00fa9a' style='font-size: large;font-family: 华文新魏'>√</font>");
                flag6 = true;
            }
        })

        $("#checkAnswer2").blur(function (t) {
            var answer = $(this).val();
            if (answer == '') {
                $('#msg7').html("<font color='red' style='font-size: large;font-family: 华文新魏'>答案不能为空！</font>");
                flag7 = false;
            }else{
                $('#msg7').html("<font color='#00fa9a' style='font-size: large;font-family: 华文新魏'>√</font>");
                flag7 = true;
            }
        })

        $("#checkAnswer3").blur(function (t) {
            var answer = $(this).val();
            if (answer == '') {
                $('#msg8').html("<font color='red' style='font-size: large;font-family: 华文新魏'>答案不能为空！</font>");
                flag8 = false;
            }else{
                $('#msg8').html("<font color='#00fa9a' style='font-size: large;font-family: 华文新魏'>√</font>");
                flag8 = true;
            }
        })



        $("form").submit(function () {
            if (flag1&&flag2&&flag3&&flag4&&flag5&&flag6&&flag7&&flag8) {
                alert("注册成功！");
            }
            return flag1&&flag2&&flag3&&flag4&&flag5&&flag6&&flag7&&flag8;

        })
    })
</script>